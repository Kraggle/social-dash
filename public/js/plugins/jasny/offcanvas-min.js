import t from"../../core/jquery/jquery.js";var s=navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i),e=function(s,i){if(this.$element=t(s),this.options=t.extend({},e.DEFAULTS,i),this.state=null,this.placement=null,this.$calcClone=null,this.calcClone(),this.options.recalc&&t(window).on("resize",t.proxy(this.recalc,this)),this.options.autohide&&!this.options.modal){navigator.userAgent.match(/(iPad|iPhone)/i);t(document).on("click touchstart",t.proxy(this.autohide,this))}t(this.$element).on("shown.bs.dropdown",t.proxy((function(s){t(this.$element).find(".dropdown .dropdown-backdrop").remove()}),this)),"boolean"==typeof this.options.disablescrolling&&(this.options.disableScrolling=this.options.disablescrolling,delete this.options.disablescrolling),this.options.toggle&&this.toggle()};e.DEFAULTS={toggle:!0,placement:"auto",autohide:!0,recalc:!0,disableScrolling:!0,modal:!1,backdrop:!1,exclude:null},e.prototype.setWidth=function(){var s=this.$element.outerWidth(),e=t(window).width();e-=68,this.$element.css("width",s>e?e:s)},e.prototype.offset=function(){switch(this.placement){case"left":case"right":return this.$element.outerWidth();case"top":case"bottom":return this.$element.outerHeight()}},e.prototype.calcPlacement=function(){if("auto"===this.options.placement){this.$element.hasClass("in")||this.$element.css("visiblity","hidden !important").addClass("in");var s=t(window).width()/this.$element.outerWidth(),e=t(window).height()/this.$element.outerHeight(),i=this.$element;this.placement=s>e?o("left","right"):o("top","bottom"),"hidden !important"===this.$element.css("visibility")&&this.$element.removeClass("in").css("visiblity","")}else this.placement=this.options.placement;function o(t,s){return"auto"===i.css(s)?t:"auto"===i.css(t)||parseInt(i.css(t),10)>parseInt(i.css(s),10)?s:t}},e.prototype.opposite=function(t){switch(t){case"top":return"bottom";case"left":return"right";case"bottom":return"top";case"right":return"left"}},e.prototype.getCanvasElements=function(){var s=this.options.canvas?t(this.options.canvas):this.$element,e=s.find("*").filter((function(){return"fixed"===getComputedStyle(this).getPropertyValue("position")})).not(this.options.exclude);return s.add(e)},e.prototype.slide=function(s,e,i){if(!t.support.transition){var o={};return o[this.placement]="+="+e,o[this.opposite(this.placement)]="-="+e,s.animate(o,350,i)}var a=this.placement,n=this.opposite(a);s.each((function(){"auto"!==t(this).css(a)&&t(this).css(a,(parseInt(t(this).css(a),10)||0)+e),"auto"!==t(this).css(n)&&t(this).css(n,(parseInt(t(this).css(n),10)||0)-e)})),this.$element.one(t.support.transition.end,i).emulateTransitionEnd(350)},e.prototype.disableScrolling=function(){var e=t("body").width(),i="padding-right";if(void 0===t("body").data("offcanvas-style")&&t("body").data("offcanvas-style",t("body").attr("style")||""),t("body").css("overflow","hidden"),s&&t("body").addClass("lockIphone"),t("body").width()>e){var o=parseInt(t("body").css(i),10)+t("body").width()-e;setTimeout((function(){t("body").css(i,o)}),1)}t("body").on("touchmove.bs",(function(s){t(event.target).closest(".offcanvas").length||s.preventDefault()}))},e.prototype.enableScrolling=function(){t("body").off("touchmove.bs"),t("body").removeClass("lockIphone")},e.prototype.show=function(){if(!this.state){var e=t.Event("show.bs.offcanvas");this.$element.trigger(e),e.isDefaultPrevented()||this.hideOthers(t.proxy((function(){this.state="slide-in",this.$element.css("width",""),this.calcPlacement(),this.setWidth();var e=this.getCanvasElements(),i=this.placement,o=this.opposite(i),a=this.offset();-1!==e.index(this.$element)&&(t(this.$element).data("offcanvas-style",t(this.$element).attr("style")||""),this.$element.css(i,-1*a),this.$element.css(i)),e.addClass("canvas-sliding").each((function(){var e=t(this);void 0===e.data("offcanvas-style")&&e.data("offcanvas-style",e.attr("style")||""),"static"!==e.css("position")||s||e.css("position","relative"),"auto"!==e.css(i)&&"0px"!==e.css(i)||"auto"!==e.css(o)&&"0px"!==e.css(o)||e.css(i,0)})),this.options.disableScrolling&&this.disableScrolling(),(this.options.modal||this.options.backdrop)&&this.toggleBackdrop();var n=function(){"slide-in"==this.state&&(this.state="slid",e.removeClass("canvas-sliding").addClass("canvas-slid"),this.$element.trigger("shown.bs.offcanvas"))};setTimeout(t.proxy((function(){this.$element.addClass("in"),this.slide(e,a,t.proxy(n,this))}),this),1)}),this))}},e.prototype.hideOthers=function(s){var e=!1,i=this.$element.attr("id"),o=t('.offcanvas-clone:not([data-id="'+i+'"])');if(!o.length)return s();o.each((function(i,o){var a=t(o).attr("data-id"),n=t("#"+a);(e=n.hasClass("canvas-slid"))&&(n.one("hidden.bs.offcanvas",s),n.offcanvas("hide"))})),e||s()},e.prototype.hide=function(){if("slid"===this.state){var s=t.Event("hide.bs.offcanvas");if(this.$element.trigger(s),!s.isDefaultPrevented()){this.state="slide-out";var e=t(".canvas-slid"),i=(this.placement,-1*this.offset()),o=function(){"slide-out"==this.state&&(this.state=null,this.placement=null,this.$element.removeClass("in"),e.removeClass("canvas-sliding"),e.add(this.$element).add("body").each((function(){t(this).attr("style",t(this).data("offcanvas-style")).removeData("offcanvas-style")})),this.$element.css("width",""),this.$element.trigger("hidden.bs.offcanvas"))};this.options.disableScrolling&&this.enableScrolling(),(this.options.modal||this.options.backdrop)&&this.toggleBackdrop(),e.removeClass("canvas-slid").addClass("canvas-sliding"),setTimeout(t.proxy((function(){this.slide(e,i,t.proxy(o,this))}),this),1)}}},e.prototype.toggle=function(){"slide-in"!==this.state&&"slide-out"!==this.state&&this["slid"===this.state?"hide":"show"]()},e.prototype.toggleBackdrop=function(s){s=s||t.noop;if("slide-in"==this.state){var e=t("body"),i=t.support.transition;this.$backdrop=t('<div class="modal-backdrop fade" />'),this.options.backdrop?(this.$backdrop.addClass("allow-navbar"),this.options.canvas&&t(this.options.canvas)[0]!==e[0]?(t(this.options.canvas).addClass("limit-backdrop"),this.$backdrop.appendTo(this.options.canvas)):this.$backdrop.insertAfter(this.$element)):this.$backdrop.insertAfter(this.$element),i&&this.$backdrop[0].offsetWidth,e.addClass("modal-open"),this.$backdrop.addClass("show").show(),this.$backdrop.on("click.bs",t.proxy(this.autohide,this)),i?this.$backdrop.one(t.support.transition.end,s).emulateTransitionEnd(150):s()}else if("slide-out"==this.state&&this.$backdrop){var o=this;if(this.$backdrop.hide().removeClass("show"),t("body").removeClass("modal-open").off("touchmove.bs"),t.support.transition?this.$backdrop.one(t.support.transition.end,(function(){o.$backdrop.remove(),s(),o.$backdrop=null})).emulateTransitionEnd(150):(this.$backdrop.remove(),this.$backdrop=null,s()),this.options.canvas&&t(this.options.canvas)[0]!==t("body")[0]){var a=this.options.canvas;setTimeout((function(){t(a).removeClass("limit-backdrop")}),150)}}else s&&s()},e.prototype.calcClone=function(){var s=this.$element.attr("id");this.$calcClone=t('.offcanvas-clone[data-id="'+s+'"]'),this.$calcClone.length||(this.$calcClone=this.$element.clone().addClass("offcanvas-clone").attr("data-id",s).removeAttr("id").appendTo(t("body")).html("")),this.$calcClone.removeClass("in")},e.prototype.recalc=function(){if("none"!==this.$calcClone.css("display")&&("slid"===this.state||"slide-in"===this.state)){this.state=null,this.placement=null;var s=this.getCanvasElements();this.$element.trigger("hide.bs.offcanvas"),this.$element.removeClass("in"),s.removeClass("canvas-slid"),s.add(this.$element).add("body").each((function(){t(this).attr("style",t(this).data("offcanvas-style")).removeData("offcanvas-style")})),this.$element.trigger("hidden.bs.offcanvas")}},e.prototype.autohide=function(s){var e=t(s.target);!e.hasClass("dropdown-backdrop")&&0===e.closest(this.$element).length&&this.hide()};var i=t.fn.offcanvas;t.fn.offcanvas=function(s){return this.each((function(){var i=t(this),o=i.data("bs.offcanvas"),a=t.extend({},e.DEFAULTS,i.data(),"object"==typeof s&&s);i.hasClass("offcanvas-clone")||(o||i.data("bs.offcanvas",o=new e(this,a)),"string"==typeof s&&o[s]())}))},t.fn.offcanvas.Constructor=e,t.fn.offcanvas.noConflict=function(){return t.fn.offcanvas=i,this},t(document).on("click.bs.offcanvas.data-api","[data-toggle=offcanvas]",(function(s){var e,i=t(this),o=i.attr("data-bs-target")||(e=i.attr("href"))&&e.replace(/.*(?=#[^\s]+$)/,""),a=t(o),n=a.data("bs.offcanvas"),l=n?"toggle":t.extend(i.data(),a.data());s.preventDefault(),s.stopPropagation(),n?n.toggle():a.offcanvas(l)}));export default e;