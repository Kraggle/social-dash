import*as l from"./lib/css.js";import*as t from"./lib/dom.js";import s from"./lib/class-names.js";import i from"./lib/event-manager.js";import r from"./process-scroll-diff.js";import e from"./update-geometry.js";import{toInt as o,outerWidth as a}from"./lib/util.js";import h from"./handlers/click-rail.js";import c from"./handlers/drag-thumb.js";import n from"./handlers/keyboard.js";import b from"./handlers/mouse-wheel.js";import d from"./handlers/touch.js";const m={"click-rail":h,"drag-thumb":c,keyboard:n,wheel:b,touch:d};export default class p{constructor(r,h={}){if("string"==typeof r&&(r=document.querySelector(r)),!r||!r.nodeName)throw new Error("no element is specified to initialize PerfectScrollbar");this.element=r,r.classList.add(s.main),this.settings={handlers:["click-rail","drag-thumb","keyboard","wheel","touch"],maxScrollbarLength:null,minScrollbarLength:null,scrollingThreshold:1e3,scrollXMarginOffset:0,scrollYMarginOffset:0,suppressScrollX:!1,suppressScrollY:!1,swipeEasing:!0,useBothWheelAxes:!1,wheelPropagation:!0,wheelSpeed:1};for(const l in h)this.settings[l]=h[l];this.containerWidth=null,this.containerHeight=null,this.contentWidth=null,this.contentHeight=null;const c=()=>r.classList.add(s.state.focus),n=()=>r.classList.remove(s.state.focus);this.isRtl="rtl"===l.get(r).direction,!0===this.isRtl&&r.classList.add(s.rtl),this.isNegativeScroll=(()=>{const l=r.scrollLeft;let t=null;return r.scrollLeft=-1,t=r.scrollLeft<0,r.scrollLeft=l,t})(),this.negativeScrollAdjustment=this.isNegativeScroll?r.scrollWidth-r.clientWidth:0,this.event=new i,this.ownerDocument=r.ownerDocument||document,this.scrollbarXRail=t.div(s.element.rail("x")),r.appendChild(this.scrollbarXRail),this.scrollbarX=t.div(s.element.thumb("x")),this.scrollbarXRail.appendChild(this.scrollbarX),this.scrollbarX.setAttribute("tabindex",0),this.event.bind(this.scrollbarX,"focus",c),this.event.bind(this.scrollbarX,"blur",n),this.scrollbarXActive=null,this.scrollbarXWidth=null,this.scrollbarXLeft=null;const b=l.get(this.scrollbarXRail);this.scrollbarXBottom=parseInt(b.bottom,10),isNaN(this.scrollbarXBottom)?(this.isScrollbarXUsingBottom=!1,this.scrollbarXTop=o(b.top)):this.isScrollbarXUsingBottom=!0,this.railBorderXWidth=o(b.borderLeftWidth)+o(b.borderRightWidth),l.set(this.scrollbarXRail,{display:"block"}),this.railXMarginWidth=o(b.marginLeft)+o(b.marginRight),l.set(this.scrollbarXRail,{display:""}),this.railXWidth=null,this.railXRatio=null,this.scrollbarYRail=t.div(s.element.rail("y")),r.appendChild(this.scrollbarYRail),this.scrollbarY=t.div(s.element.thumb("y")),this.scrollbarYRail.appendChild(this.scrollbarY),this.scrollbarY.setAttribute("tabindex",0),this.event.bind(this.scrollbarY,"focus",c),this.event.bind(this.scrollbarY,"blur",n),this.scrollbarYActive=null,this.scrollbarYHeight=null,this.scrollbarYTop=null;const d=l.get(this.scrollbarYRail);this.scrollbarYRight=parseInt(d.right,10),isNaN(this.scrollbarYRight)?(this.isScrollbarYUsingRight=!1,this.scrollbarYLeft=o(d.left)):this.isScrollbarYUsingRight=!0,this.scrollbarYOuterWidth=this.isRtl?a(this.scrollbarY):null,this.railBorderYWidth=o(d.borderTopWidth)+o(d.borderBottomWidth),l.set(this.scrollbarYRail,{display:"block"}),this.railYMarginHeight=o(d.marginTop)+o(d.marginBottom),l.set(this.scrollbarYRail,{display:""}),this.railYHeight=null,this.railYRatio=null,this.reach={x:r.scrollLeft<=0?"start":r.scrollLeft>=this.contentWidth-this.containerWidth?"end":null,y:r.scrollTop<=0?"start":r.scrollTop>=this.contentHeight-this.containerHeight?"end":null},this.isAlive=!0,this.settings.handlers.forEach((l=>m[l](this))),this.lastScrollTop=Math.floor(r.scrollTop),this.lastScrollLeft=r.scrollLeft,this.event.bind(this.element,"scroll",(l=>this.onScroll(l))),e(this)}update(){this.isAlive&&(this.negativeScrollAdjustment=this.isNegativeScroll?this.element.scrollWidth-this.element.clientWidth:0,l.set(this.scrollbarXRail,{display:"block"}),l.set(this.scrollbarYRail,{display:"block"}),this.railXMarginWidth=o(l.get(this.scrollbarXRail).marginLeft)+o(l.get(this.scrollbarXRail).marginRight),this.railYMarginHeight=o(l.get(this.scrollbarYRail).marginTop)+o(l.get(this.scrollbarYRail).marginBottom),l.set(this.scrollbarXRail,{display:"none"}),l.set(this.scrollbarYRail,{display:"none"}),e(this),r(this,"top",0,!1,!0),r(this,"left",0,!1,!0),l.set(this.scrollbarXRail,{display:""}),l.set(this.scrollbarYRail,{display:""}))}onScroll(l){this.isAlive&&(e(this),r(this,"top",this.element.scrollTop-this.lastScrollTop),r(this,"left",this.element.scrollLeft-this.lastScrollLeft),this.lastScrollTop=Math.floor(this.element.scrollTop),this.lastScrollLeft=this.element.scrollLeft)}destroy(){this.isAlive&&(this.event.unbindAll(),t.remove(this.scrollbarX),t.remove(this.scrollbarY),t.remove(this.scrollbarXRail),t.remove(this.scrollbarYRail),this.removePsClasses(),this.element=null,this.scrollbarX=null,this.scrollbarY=null,this.scrollbarXRail=null,this.scrollbarYRail=null,this.isAlive=!1)}removePsClasses(){this.element.className=this.element.className.split(" ").filter((l=>!l.match(/^ps([-_].+|)$/))).join(" ")}}