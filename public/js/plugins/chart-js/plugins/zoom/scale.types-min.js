import{valueOrDefault as n}from"../../src/helpers/index.js";import{getState as t}from"./state.js";function a(n,t,a){const e=n.max-n.min,i=e*(t-1),m=n.isHorizontal()?a.x:a.y,o=(n.getValueForPixel(m)-n.min)/e||0;return{min:i*o,max:i*(1-o)}}function e(t,a,e,i,m){let o=e[i];if("original"===o){const e=t.originalScaleLimits[a.id][i];o=n(e.options,e.scale)}return n(o,m)}export function updateRange(n,{min:a,max:i},m,o=!1){const r=t(n.chart),{id:s,axis:u,options:x}=n,c=m&&(m[s]||m[u])||{},{minRange:l=0}=c,h=e(r,n,c,"min",-1/0),d=e(r,n,c,"max",1/0),g=Math.max(a,h),f=Math.min(i,d),p=o?Math.max(f-g,l):n.max-n.min;if(f-g!==p)if(h>f-p)a=g,i=g+p;else if(d<g+p)i=f,a=f-p;else{const n=(p-f+g)/2;a=g-n,i=f+n}else a=g,i=f;return x.min=a,x.max=i,r.updatedScaleLimits[n.id]={min:a,max:i},n.parse(a)!==n.min||n.parse(i)!==n.max}const i=n=>0===n||isNaN(n)?0:n<0?Math.min(Math.round(n),-1):Math.max(Math.round(n),1);const m={second:500,minute:3e4,hour:18e5,day:432e5,week:3024e5,month:1296e6,quarter:5184e6,year:157248e5};function o(n,t,a,e=!1){const{min:i,max:o,options:r}=n,s=r.time&&r.time.round,u=m[s]||0,x=n.getValueForPixel(n.getPixelForValue(i+u)-t),c=n.getValueForPixel(n.getPixelForValue(o+u)-t),{min:l=-1/0,max:h=1/0}=e&&a&&a[n.axis]||{};return!!(isNaN(x)||isNaN(c)||x<l||c>h)||updateRange(n,{min:x,max:c},a,e)}function r(n,t,a){return o(n,t,a,!0)}export const zoomFunctions={category:function(n,t,e,m){const o=a(n,t,e);return n.min===n.max&&t<1&&function(n){const t=n.getLabels().length-1;n.min>0&&(n.min-=1),n.max<t&&(n.max+=1)}(n),updateRange(n,{min:n.min+i(o.min),max:n.max-i(o.max)},m,!0)},default:function(n,t,e,i){const m=a(n,t,e);return updateRange(n,{min:n.min+m.min,max:n.max-m.max},i,!0)}};export const panFunctions={category:function(n,t,a){const e=n.getLabels().length-1;let{min:i,max:m}=n;const o=Math.max(m-i,1),r=Math.round(function(n){return n.isHorizontal()?n.width:n.height}(n)/Math.max(o,10)),s=Math.round(Math.abs(t/r));let u;return t<-r?(m=Math.min(m+s,e),i=1===o?m:m-o,u=m===e):t>r&&(i=Math.max(0,i-s),m=1===o?i:i+o,u=0===i),updateRange(n,{min:i,max:m},a)||u},default:o,logarithmic:r,timeseries:r};