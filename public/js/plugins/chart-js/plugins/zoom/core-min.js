import{each as o,callback as t,sign as n,valueOrDefault as i}from"../../src/helpers/index.js";import{panFunctions as e,updateRange as s,zoomFunctions as a}from"./scale.types.js";import{getState as c}from"./state.js";import{directionEnabled as m,getEnabledScalesByPoint as r}from"./utils.js";function l(t,n){o(t,((o,i)=>{n[i]||delete t[i]}))}function u(t,n){const{scales:i}=t,{originalScaleLimits:e,updatedScaleLimits:s}=n;return o(i,(function(o){(function(o,t,n){const{id:i,options:{min:e,max:s}}=o;if(!t[i]||!n[i])return!0;const a=n[i];return a.min!==e||a.max!==s})(o,e,s)&&(e[o.id]={min:{scale:o.min,options:o.options.min},max:{scale:o.max,options:o.options.max}})})),l(e,i),l(s,i),e}function p(o,n,i,e){const s=a[o.type]||a.default;t(s,[o,n,i,e])}function x(o){const t=o.chartArea;return{x:(t.left+t.right)/2,y:(t.top+t.bottom)/2}}export function zoom(n,i,e="none"){const{x:s=1,y:a=1,focalPoint:l=x(n)}="number"==typeof i?{x:i,y:i}:i,f=c(n),{options:{limits:d,zoom:y}}=f,{mode:h="xy",overScaleMode:z}=y||{};u(n,f);const g=1!==s&&m(h,"x",n),H=1!==a&&m(h,"y",n),M=z&&r(z,l,n);o(M||n.scales,(function(o){o.isHorizontal()&&g?p(o,s,l,d):!o.isHorizontal()&&H&&p(o,a,l,d)})),n.update(e),t(y.onZoom,[{chart:n}])}function f(o,t,n){const i=o.getValueForPixel(t),e=o.getValueForPixel(n);return{min:Math.min(i,e),max:Math.max(i,e)}}export function zoomRect(n,i,e,a="none"){const r=c(n),{options:{limits:l,zoom:p}}=r,{mode:x="xy"}=p;u(n,r);const d=m(x,"x",n),y=m(x,"y",n);o(n.scales,(function(o){o.isHorizontal()&&d?s(o,f(o,i.x,e.x),l,!0):!o.isHorizontal()&&y&&s(o,f(o,i.y,e.y),l,!0)})),n.update(a),t(p.onZoom,[{chart:n}])}export function zoomScale(o,t,n,i="none"){u(o,c(o));const e=o.scales[t];s(e,n,void 0,!0),o.update(i)}export function resetZoom(n,i="default"){const e=c(n),s=u(n,e);o(n.scales,(function(o){const t=o.options;s[o.id]?(t.min=s[o.id].min.options,t.max=s[o.id].max.options):(delete t.min,delete t.max)})),n.update(i),t(e.options.zoom.onZoomComplete,[{chart:n}])}export function getZoomLevel(t){const n=c(t);let e=1,s=1;return o(t.scales,(function(o){const t=function(o,t){const n=o.originalScaleLimits[t];if(!n)return;const{min:e,max:s}=n;return i(s.options,s.scale)-i(e.options,e.scale)}(n,o.id);if(t){const n=Math.round(t/(o.max-o.min)*100)/100;e=Math.min(e,n),s=Math.max(s,n)}})),e<1?e:s}function d(o,i,s,a){const{panDelta:c}=a,m=c[o.id]||0;n(m)===n(i)&&(i+=m);const r=e[o.type]||e.default;t(r,[o,i,s])?c[o.id]=0:c[o.id]=i}export function pan(n,i,e,s="none"){const{x:a=0,y:r=0}="number"==typeof i?{x:i,y:i}:i,l=c(n),{options:{pan:p,limits:x}}=l,{mode:f="xy",onPan:y}=p||{};u(n,l);const h=0!==a&&m(f,"x",n),z=0!==r&&m(f,"y",n);o(e||n.scales,(function(o){o.isHorizontal()&&h?d(o,a,x,l):!o.isHorizontal()&&z&&d(o,r,x,l)})),n.update(s),t(y,[{chart:n}])}