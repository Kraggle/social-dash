import*as e from"../../popper.js";import{defineJQueryPlugin as t,getElement as n,getElementFromSelector as o,isDisabled as s,isElement as r,isVisible as i,isRTL as a,noop as p,getNextActiveElement as c,typeCheckConfig as d}from"./util/index.js";import l from"./dom/event-handler.js";import u from"./dom/manipulator.js";import f from"./dom/selector-engine.js";import m from"./base-component.js";const h="dropdown",g=new RegExp("ArrowUp|ArrowDown|Escape"),_=a()?"top-end":"top-start",w=a()?"top-start":"top-end",y=a()?"bottom-end":"bottom-start",b=a()?"bottom-start":"bottom-end",v=a()?"left-start":"right-start",k=a()?"right-start":"left-start",E={offset:[0,2],boundary:"clippingParents",reference:"toggle",display:"dynamic",popperConfig:null,autoClose:!0},C={offset:"(array|string|function)",boundary:"(string|element)",reference:"(string|element|object)",display:"string",popperConfig:"(null|object|function)",autoClose:"(boolean|string)"};class A extends m{constructor(e,t){super(e),this._popper=null,this._config=this._getConfig(t),this._menu=this._getMenuElement(),this._inNavbar=this._detectNavbar(),this._addEventListeners()}static get Default(){return E}static get DefaultType(){return C}static get NAME(){return h}toggle(){if(s(this._element))return;this._element.classList.contains("show")?this.hide():this.show()}show(){if(s(this._element)||this._menu.classList.contains("show"))return;const t=A.getParentFromElement(this._element),o={relatedTarget:this._element};if(!l.trigger(this._element,"show.bs.dropdown",o).defaultPrevented){if(this._inNavbar)u.setDataAttribute(this._menu,"popper","none");else{if(void 0===e)throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let o=this._element;"parent"===this._config.reference?o=t:r(this._config.reference)?o=n(this._config.reference):"object"==typeof this._config.reference&&(o=this._config.reference);const s=this._getPopperConfig(),i=s.modifiers.find((e=>"applyStyles"===e.name&&!1===e.enabled));this._popper=e.createPopper(o,this._menu,s),i&&u.setDataAttribute(this._menu,"popper","static")}"ontouchstart"in document.documentElement&&!t.closest(".navbar-nav")&&[].concat(...document.body.children).forEach((e=>l.on(e,"mouseover",p))),this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.toggle("show"),this._element.classList.toggle("show"),l.trigger(this._element,"shown.bs.dropdown",o)}}hide(){if(s(this._element)||!this._menu.classList.contains("show"))return;const e={relatedTarget:this._element};this._completeHide(e)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_addEventListeners(){l.on(this._element,"click.bs.dropdown",(e=>{e.preventDefault(),this.toggle()}))}_completeHide(e){l.trigger(this._element,"hide.bs.dropdown",e).defaultPrevented||("ontouchstart"in document.documentElement&&[].concat(...document.body.children).forEach((e=>l.off(e,"mouseover",p))),this._popper&&this._popper.destroy(),this._menu.classList.remove("show"),this._element.classList.remove("show"),this._element.setAttribute("aria-expanded","false"),u.removeDataAttribute(this._menu,"popper"),l.trigger(this._element,"hidden.bs.dropdown",e))}_getConfig(e){if(e={...this.constructor.Default,...u.getDataAttributes(this._element),...e},d(h,e,this.constructor.DefaultType),"object"==typeof e.reference&&!r(e.reference)&&"function"!=typeof e.reference.getBoundingClientRect)throw new TypeError(`${h.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return e}_getMenuElement(){return f.next(this._element,".dropdown-menu")[0]}_getPlacement(){const e=this._element.parentNode;if(e.classList.contains("dropend"))return v;if(e.classList.contains("dropstart"))return k;const t="end"===getComputedStyle(this._menu).getPropertyValue("--bs-position").trim();return e.classList.contains("dropup")?t?w:_:t?b:y}_detectNavbar(){return null!==this._element.closest(".navbar")}_getOffset(){const{offset:e}=this._config;return"string"==typeof e?e.split(",").map((e=>Number.parseInt(e,10))):"function"==typeof e?t=>e(t,this._element):e}_getPopperConfig(){const e={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return"static"===this._config.display&&(e.modifiers=[{name:"applyStyles",enabled:!1}]),{...e,..."function"==typeof this._config.popperConfig?this._config.popperConfig(e):this._config.popperConfig}}_selectMenuItem({key:e,target:t}){const n=f.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",this._menu).filter(i);n.length&&c(n,t,"ArrowDown"===e,!n.includes(t)).focus()}static dropdownInterface(e,t){const n=A.getOrCreateInstance(e,t);if("string"==typeof t){if(void 0===n[t])throw new TypeError(`No method named "${t}"`);n[t]()}}static jQueryInterface(e){return this.each((function(){A.dropdownInterface(this,e)}))}static clearMenus(e){if(e&&(2===e.button||"keyup"===e.type&&"Tab"!==e.key))return;const t=f.find('[data-bs-toggle="dropdown"]');for(let n=0,o=t.length;n<o;n++){const o=A.getInstance(t[n]);if(!o||!1===o._config.autoClose)continue;if(!o._element.classList.contains("show"))continue;const s={relatedTarget:o._element};if(e){const t=e.composedPath(),n=t.includes(o._menu);if(t.includes(o._element)||"inside"===o._config.autoClose&&!n||"outside"===o._config.autoClose&&n)continue;if(o._menu.contains(e.target)&&("keyup"===e.type&&"Tab"===e.key||/input|select|option|textarea|form/i.test(e.target.tagName)))continue;"click"===e.type&&(s.clickEvent=e)}o._completeHide(s)}}static getParentFromElement(e){return o(e)||e.parentNode}static dataApiKeydownHandler(e){if(/input|textarea/i.test(e.target.tagName)?"Space"===e.key||"Escape"!==e.key&&("ArrowDown"!==e.key&&"ArrowUp"!==e.key||e.target.closest(".dropdown-menu")):!g.test(e.key))return;const t=this.classList.contains("show");if(!t&&"Escape"===e.key)return;if(e.preventDefault(),e.stopPropagation(),s(this))return;const n=()=>this.matches('[data-bs-toggle="dropdown"]')?this:f.prev(this,'[data-bs-toggle="dropdown"]')[0];return"Escape"===e.key?(n().focus(),void A.clearMenus()):"ArrowUp"===e.key||"ArrowDown"===e.key?(t||n().click(),void A.getInstance(n())._selectMenuItem(e)):void(t&&"Space"!==e.key||A.clearMenus())}}l.on(document,"keydown.bs.dropdown.data-api",'[data-bs-toggle="dropdown"]',A.dataApiKeydownHandler),l.on(document,"keydown.bs.dropdown.data-api",".dropdown-menu",A.dataApiKeydownHandler),l.on(document,"click.bs.dropdown.data-api",A.clearMenus),l.on(document,"keyup.bs.dropdown.data-api",A.clearMenus),l.on(document,"click.bs.dropdown.data-api",'[data-bs-toggle="dropdown"]',(function(e){e.preventDefault(),A.dropdownInterface(this)})),t(A);export default A;