import t from"../../core/jquery/jquery.js";import e from"../../plugins/K.js";import a from"../../plugins/chart-js/chart.js";import o from"./chart-options.js";import s from"./shared.js";import n from"../../plugins/dayjs/index.js";export default(i={})=>{const d=e.extend(!0,{chartId:"",scales:{},page:"all",options:{maintainAspectRatio:!0,aspectRatio:4}},i);let c=t(d.chartId);if(!c.length)return;const h=c.get(0).getContext("2d"),l=c.data("type")||"line",r=[],p=c.closest(".card").find("[data-chart-toggles] input"),m=c.closest(".card").find("[data-chart-scale]");let u;p.each((function(){const e=t(this).data();e.options={color:e.color,label:e.label,btn:this,hidden:!t(this).is(":checked")},r.push(e.options)}));const g=(t="day")=>{u&&u.destroy();const s=[],i=[],p=d.scales[t];e.each(r,((a,d)=>{let c,r=n().add(-p.count,t);const m=[];for(let a=0;a<p.count;a++)m.push({x:r.format("month"==t?"MMM 'YY":"DD/MM"),y:c=e.random(p.min,p.max)}),r=r.clone().add(1,t),i.push(c);s.push(e.extend({},o.dataset(l,d.color,h,!0),{hidden:d.hidden,label:d.label,data:m})),d.index=a}));let m={type:l,data:{datasets:s},options:e.extend(!0,{},o.options(l),{scales:{yAxes:{suggestedMin:Math.max(0,Math.min.apply(null,i)-10),suggestedMax:Math.max.apply(null,i)+10}}},d.options)};u=new a(h,m),c.data("chart",u)};g(m.find(":checked").val()),m.find("input").on("change",(()=>{const t=m.find(":checked");s.setPageCookie(d.page,{[t.attr("name")]:t.attr("id")}),g(t.val())})),p.on("change",(function(){const e=t(this).data("options"),a=e.hidden=!t(this).is(":checked");p.each((function(){s.setPageCookie(d.page,{[t(this).attr("id")]:t(this).is(":checked")})})),u[a?"hide":"show"](e.index)}))};