import t from"../../core/jquery/jquery.js";import a from"../../plugins/K.js";import e from"../../plugins/chart-js/chart.js";import i from"./chart-options.js";import n from"./shared.js";import s from"../../plugins/dayjs/index.js";export default(o={})=>{const c=a.extend(!0,{chartId:"",scales:{},page:"all",options:{maintainAspectRatio:!1,aspectRatio:4}},o);let d=t(c.chartId);if(!d.length)return;const h=d.get(0),l=d.data("type")||"line";let r=d.parent(),p=d.data("height")||"auto";r.hasClass("chart-area")||r.addClass("chart-area"),r.height(c.options.maintainAspectRatio?"auto":p).css("min-height","initial");const g=[],u=d.closest(".card"),m=u.find("[data-chart-toggles] input"),f=u.find("[data-chart-scale]"),x=u.find("[data-flatpickr]");let M;m.each((function(){const a=t(this).data();a.options={color:a.color,label:a.label,btn:this,hidden:!t(this).is(":checked")},g.push(a.options)}));const y=()=>{M&&M.destroy();const t=[],n=[],o=f.find(":checked").val()||"day",r=c.scales[o];let p=s(x.length?x.val():void 0),u=Math.ceil(r.count/2);p=p.add(u,o),p.isAfter(s())&&(p=s()),a.each(g,((e,s)=>{let c,d=p.clone().add(-r.count,o);const g=[];for(let t=0;t<r.count;t++)g.push({x:d.format("month"==o?"MMM 'YY":"D MMM"),y:c=a.random(r.min,r.max)}),d=d.clone().add(1,o),n.push(c);t.push(a.extend({},i.dataset(l,s.color,h,!0),{hidden:s.hidden,label:s.label,data:g})),s.index=e}));let m={type:l,data:{datasets:t},options:a.extend(!0,{},i.options(l),{scales:{yAxes:{suggestedMin:Math.max(0,Math.min.apply(null,n)-10),suggestedMax:Math.max.apply(null,n)+10}}},c.options)};M=new e(h,m),d.data("chart",M)};y(),f.find("input").on("change",(()=>{const t=f.find(":checked");n.setPageCookie(c.page,{[t.attr("name")]:t.attr("id")}),y()})),m.on("change",(function(){const a=t(this).data("options"),e=a.hidden=!t(this).is(":checked");m.each((function(){n.setPageCookie(c.page,{[t(this).attr("id")]:t(this).is(":checked")})})),M[e?"hide":"show"](a.index)})),x.length&&(x.flatpickr(),x.on("change",(function(){n.setPageCookie(c.page,{[t(this).attr("id")]:t(this).val()}),y()})))};