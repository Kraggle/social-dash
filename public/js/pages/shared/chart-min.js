import t from"../../core/jquery/jquery.js";import e from"../../plugins/K.js";import a from"../../plugins/chart-js/chart.js";import n from"./chart-options.js";import o from"./shared.js";import i from"../../plugins/dayjs/index.js";export default(s={})=>{const d=e.extend(!0,{chartId:"",scales:{},page:"all",options:{maintainAspectRatio:!0,aspectRatio:4}},s);let c=t(d.chartId);if(!c.length)return;const h=c.get(0).getContext("2d"),l=c.data("type")||"line",r=[],p=c.closest(".card"),f=p.find("[data-chart-toggles] input"),u=p.find("[data-chart-scale]"),g=p.find("[data-flatpickr]");let m;f.each((function(){const e=t(this).data();e.options={color:e.color,label:e.label,btn:this,hidden:!t(this).is(":checked")},r.push(e.options)}));const x=()=>{m&&m.destroy();const t=[],o=[],s=u.find(":checked").val()||"day",p=d.scales[s];let f=i(g.length?g.val():void 0),x=Math.ceil(p.count/2);f=f.add(x,s),f.isAfter(i())&&(f=i()),e.each(r,((a,i)=>{let d,c=f.clone().add(-p.count,s);const r=[];for(let t=0;t<p.count;t++)r.push({x:c.format("month"==s?"MMM 'YY":"DD/MM"),y:d=e.random(p.min,p.max)}),c=c.clone().add(1,s),o.push(d);t.push(e.extend({},n.dataset(l,i.color,h,!0),{hidden:i.hidden,label:i.label,data:r})),i.index=a}));let k={type:l,data:{datasets:t},options:e.extend(!0,{},n.options(l),{scales:{yAxes:{suggestedMin:Math.max(0,Math.min.apply(null,o)-10),suggestedMax:Math.max.apply(null,o)+10}}},d.options)};m=new a(h,k),c.data("chart",m)};x(u.find(":checked").val()),u.find("input").on("change",(()=>{const t=u.find(":checked");o.setPageCookie(d.page,{[t.attr("name")]:t.attr("id")}),x()})),f.on("change",(function(){const e=t(this).data("options"),a=e.hidden=!t(this).is(":checked");f.each((function(){o.setPageCookie(d.page,{[t(this).attr("id")]:t(this).is(":checked")})})),m[a?"hide":"show"](e.index)})),g.flatpickr(),g.on("change",(function(){o.setPageCookie(d.page,{[t(this).attr("id")]:t(this).val()}),x()}))};